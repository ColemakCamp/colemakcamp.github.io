function processLastWord(){!timeLimitMode&&score==scoreMax-1&&checkAnswer()&&gameON&&(console.log("game over"),endGame())}function processBackspace(e){e.preventDefault(),e.ctrlKey?checkAnswerToIndex()?processCorrectSoFar("Backspace",!0):processErrorFound("Backspace",!0):(input.value=input.value.slice(0,-1),fakeInput.innerText=fakeInput.innerText.slice(0,-1),letterIndex--,checkAnswerToIndex()?processCorrectSoFar("Backspace",!1):processErrorFound("Backspace",!1)),letterIndex<0&&(letterIndex=0)}function processEraseLetter(e){if(e){for(let e=0;e<letterIndex;e++)prompt.children[0].children[wordIndex].children[e]&&(prompt.children[0].children[wordIndex].children[e].style.color="var(--grey)");input.value="",fakeInput.innerText="",letterIndex=0}else prompt.children[0].children[wordIndex].children[letterIndex]&&(prompt.children[0].children[wordIndex].children[letterIndex].style.color="var(--grey)")}function processCorrectSoFar(e,r){fakeInput.classList.remove("red"),"Backspace"===e&&(playClickSound(),processEraseLetter(r)),e||(playClickSound(),correct++,prompt.children[0].children[wordIndex].children[letterIndex-1]&&(prompt.children[0].children[wordIndex].children[letterIndex-1].style.color="var(--green)"))}function processErrorFound(e,r){console.log("error"),fakeInput.classList.add("red"),"Backspace"===e&&(playClickSound(),processEraseLetter(r)),e||(playErrorSound(),errors++,prompt.children[0].children[wordIndex].children[letterIndex-1]&&(prompt.children[0].children[wordIndex].children[letterIndex-1].style.color="var(--red)")),requireBackspaceCorrection||checkAnswerToIndex()||(letterIndex--,input.value=input.value.slice(0,-1),fakeInput.innerText=fakeInput.innerText.slice(0,-1),letterIndex<0&&(letterIndex=0))}function processIndex(e){e?letterIndex++:letterIndex!==input.value.length&&(letterIndex=input.value.length)}function processEnter(e){checkAnswer()&&gameON?(e?e.preventDefault():input.value=input.value.slice(0,-1),handleCorrectWord(),updateScoreText(),score>=scoreMax&&endGame(),input.value="",fakeInput.innerText="",letterIndex=0):(console.log("error space"),input.value+=" ",fakeInput.innerText+="Â ",letterIndex++)}function processNewLine(){prompt.classList.remove("smoothScroll"),prompt.firstChild.removeChild(prompt.firstChild.firstChild),0==prompt.firstChild.children.length&&prompt.removeChild(prompt.firstChild),promptOffset=0,prompt.style.left="-"+promptOffset+"px",deleteLatestWord=!1}function processMapping(e,r){e?"default"==keyboardMap.shiftLayer?fakeInput.innerText+=keyboardMap[r].toUpperCase():fakeInput.innerText+=keyboardMap.shiftLayer[r]:fakeInput.innerText+=keyboardMap[r]}function processUnidentified(e){let r={q:["KeyQ",!1],w:["KeyW",!1],e:["KeyE",!1],r:["KeyR",!1],t:["KeyT",!1],y:["KeyY",!1],u:["KeyU",!1],i:["KeyI",!1],o:["KeyO",!1],p:["KeyP",!1],a:["KeyA",!1],s:["KeyS",!1],d:["KeyD",!1],f:["KeyF",!1],g:["KeyG",!1],h:["KeyH",!1],j:["KeyJ",!1],k:["KeyK",!1],l:["KeyL",!1],z:["KeyZ",!1],x:["KeyX",!1],c:["KeyC",!1],v:["KeyV",!1],b:["KeyB",!1],n:["KeyN",!1],m:["KeyM",!1],";":["Semicolon",!1],Q:["KeyQ",!0],W:["KeyW",!0],E:["KeyE",!0],R:["KeyR",!0],T:["KeyT",!0],Y:["KeyY",!0],U:["KeyU",!0],I:["KeyI",!0],O:["KeyO",!0],P:["KeyP",!0],A:["KeyA",!0],S:["KeyS",!0],D:["KeyD",!0],F:["KeyF",!0],G:["KeyG",!0],H:["KeyH",!0],J:["KeyJ",!0],K:["KeyK",!0],L:["KeyL",!0],Z:["KeyZ",!0],X:["KeyX",!0],C:["KeyC",!0],V:["KeyV",!0],B:["KeyB",!0],N:["KeyN",!0],M:["KeyM",!0],":":["Semicolon",!0]};if(!e in r)return;let n=r[e][0],t=r[e][1];"true"===localStorage.getItem("keyRemapping")&&n in keyboardMap&&gameON?processMapping(t,n):fakeInput.innerText+=e,checkAnswerToIndex()?processCorrectSoFar():processErrorFound()}input.addEventListener("keydown",function(e){if("Enter"===e.key&&processEnter(e),"Backspace"===e.key?(window.backspaceKey=!0,processBackspace(e)):window.backspaceKey=!1,"Tab"!==e.key&&"Escape"!==e.key||(e.preventDefault(),reset()),"F5"===e.key&&window.location.reload(!0),specialKeys.includes(e.key)||processIndex(e),deleteLatestWord&&processNewLine(),"Unidentified"===e.key)window.unidentifiedKey=!0;else{window.unidentifiedKey=!1;let r=e.code;"true"===localStorage.getItem("keyRemapping")&&r in keyboardMap&&gameON?e.shiftKey?processMapping(!0,r):processMapping(!1,r):specialKeys.includes(e.key)||"Process"==e.key||("Process"!=e.key?fakeInput.innerText+=e.key:letterIndex--)}checkAnswerToIndex()?processCorrectSoFar():processErrorFound()}),input.addEventListener("input",function(){input.value.match(/\s$/)?processEnter():processIndex(),!0===window.unidentifiedKey&&!1===window.backspaceKey&&processUnidentified(input.value.slice(-1))});let fakeObserver=new MutationObserver(function(){processLastWord()});fakeObserver.observe(fakeInput,{childList:!0});