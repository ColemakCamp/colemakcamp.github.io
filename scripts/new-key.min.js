function processBackspace(e){e?(input.value="",fakeInput.innerText=""):(input.value=input.value.slice(0,-1),fakeInput.innerText=fakeInput.innerText.slice(0,-1))}function processUnknown(e){let r={q:["KeyQ",!1],w:["KeyW",!1],e:["KeyE",!1],r:["KeyR",!1],t:["KeyT",!1],y:["KeyY",!1],u:["KeyU",!1],i:["KeyI",!1],o:["KeyO",!1],p:["KeyP",!1],a:["KeyA",!1],s:["KeyS",!1],d:["KeyD",!1],f:["KeyF",!1],g:["KeyG",!1],h:["KeyH",!1],j:["KeyJ",!1],k:["KeyK",!1],l:["KeyL",!1],z:["KeyZ",!1],x:["KeyX",!1],c:["KeyC",!1],v:["KeyV",!1],b:["KeyB",!1],n:["KeyN",!1],m:["KeyM",!1],";":["Semicolon",!1],Q:["KeyQ",!0],W:["KeyW",!0],E:["KeyE",!0],R:["KeyR",!0],T:["KeyT",!0],Y:["KeyY",!0],U:["KeyU",!0],I:["KeyI",!0],O:["KeyO",!0],P:["KeyP",!0],A:["KeyA",!0],S:["KeyS",!0],D:["KeyD",!0],F:["KeyF",!0],G:["KeyG",!0],H:["KeyH",!0],J:["KeyJ",!0],K:["KeyK",!0],L:["KeyL",!0],Z:["KeyZ",!0],X:["KeyX",!0],C:["KeyC",!0],V:["KeyV",!0],B:["KeyB",!0],N:["KeyN",!0],M:["KeyM",!0],":":["Semicolon",!0]},n="";for(let t=0;t<e.length;t++)if(e[t]in r){let o=r[e[t]][0],l=r[e[t]][1];"true"===localStorage.getItem("keyRemapping")&&o in keyboardMap&&gameON?n+=processMapping(l,o):n+=e[t]}fakeInput.innerText=n}function processMapping(e,r){return e?"default"==keyboardMap.shiftLayer?keyboardMap[r].toUpperCase():keyboardMap.shiftLayer[r]:keyboardMap[r]}function processNewLine(){prompt.classList.remove("smoothScroll"),prompt.firstChild.removeChild(prompt.firstChild.firstChild),0==prompt.firstChild.children.length&&prompt.removeChild(prompt.firstChild),promptOffset=0,prompt.style.left="",deleteLatestWord=!1}function processLastWord(){!timeLimitMode&&score==scoreMax-1&&checkAnswer()&&gameON&&(console.log("game over"),endGame())}function processEnter(){checkAnswer()&&gameON?(handleCorrectWord(),updateScoreText(),score>=scoreMax&&endGame(),input.value="",fakeInput.innerText="",letterIndex=0):(console.log("error space"),input.value+=" ",fakeInput.innerText+="Â ",letterIndex++)}function processIndex(){letterIndex=fakeInput.innerText.length}function colorMeGrey(){if(0===letterIndex)return;let e=prompt.querySelector(".line:not(.done)").children[wordIndex].children;for(let r=0;r<letterIndex;r++)try{e[r].classList.add("grey")}catch{}}function processCorrectSoFar(){fakeInput.classList.remove("red"),playClickSound(),correct++;try{prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex-1].classList.add("grey"),prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex-1].classList.remove("red"),prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex-1].style.color="var(--green)",prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex].style.color=""}catch{}}function processErrorFound(){fakeInput.classList.add("red"),playErrorSound(),errors++;try{prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex-1].classList.add("grey"),prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex-1].style.color="var(--red)"}catch{}if(requireBackspaceCorrection||checkAnswerToIndex())try{prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex].style.color=""}catch{}else letterIndex--,input.value=input.value.slice(0,-1),fakeInput.innerText=fakeInput.innerText.slice(0,-1),prompt.querySelector(".line:not(.done)").children[wordIndex].children[letterIndex].classList.add("red"),letterIndex<0&&(letterIndex=0)}function clearColors(){if(0!==letterIndex)return;let e=prompt.querySelector(".line:not(.done)").children[wordIndex].querySelectorAll("span[style]");for(let r=0;r<e.length;r++)e[r].style.color=""}input.addEventListener("keydown",function(e){if(window.unknownKey=!1,"Unidentified"===e.key||"Process"===e.key)window.unknownKey=!0;else{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),processEnter()),"Tab"!==e.key&&"Escape"!==e.key||(e.preventDefault(),reset()),"F5"===e.key&&window.location.reload(!0),"Backspace"===e.key&&(e.preventDefault(),e.ctrlKey?processBackspace(!0):processBackspace(!1));let r=e.code;"true"===localStorage.getItem("keyRemapping")&&r in keyboardMap&&gameON?e.shiftKey?fakeInput.innerText+=processMapping(!0,r):fakeInput.innerText+=processMapping(!1,r):specialKeys.includes(e.key)||(fakeInput.innerText+=e.key)}}),input.addEventListener("input",function(){window.unknownKey&&(" "===input.value.slice(-1)?(input.value=input.value.slice(0,-1),processEnter()):processUnknown(input.value))}),input.addEventListener("keyup",function(e){e.preventDefault()});let fakeObserver=new MutationObserver(function(){processIndex(),processLastWord(),deleteLatestWord&&processNewLine(),checkAnswerToIndex()?processCorrectSoFar():processErrorFound(),colorMeGrey(),clearColors()});fakeObserver.observe(fakeInput,{childList:!0});