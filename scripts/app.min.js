function start(){inputKeyboard.innerHTML=customLayout[currentKeyboard],wordScrollingMode||toggleWordScrollingModeUI(),fullSentenceModeEnabled&&toggleFullSentenceModeUI(),timeLimitMode&&toggleTimeLimitModeUI(),"true"===localStorage.getItem("keyRemapping")&&mappingStatusButton.setAttribute("data-value","on"),layout.setAttribute("data-value",currentLayout),keyboard.setAttribute("data-value",currentKeyboard),navInit(),localStorage.getItem("preferenceMenu")&&openMenu(),showCheatsheet||document.querySelector(".cheatsheet").classList.add("dispose"),switchLevel(currentLevel),updateLayoutUI()}function navInit(){!0==!onlyLower?capitalLettersAllowed.classList.add("active"):capitalLettersAllowed.classList.remove("active"),""!==punctuation?punctuationModeButton.classList.add("active"):punctuationModeButton.classList.remove("active"),!0===requireBackspaceCorrection?requireBackspaceCorrectionToggle.classList.add("active"):requireBackspaceCorrectionToggle.classList.remove("active"),!0===fullSentenceModeEnabled?fullSentenceModeToggle.classList.add("active"):fullSentenceModeToggle.classList.remove("active"),!0===wordScrollingMode?wordScrollingModeButton.classList.add("active"):wordScrollingModeButton.classList.remove("active"),!0===timeLimitMode?timeLimitModeButton.classList.add("active"):timeLimitModeButton.classList.remove("active"),!0==!timeLimitMode?wordLimitModeButton.classList.add("active"):wordLimitModeButton.classList.remove("active"),!0===showCheatsheet?showCheatsheetButton.classList.add("active"):showCheatsheetButton.classList.remove("active"),!0===playSoundOnClick?playSoundOnClickButton.classList.add("active"):playSoundOnClickButton.classList.remove("active"),!0===playSoundOnError?playSoundOnErrorButton.classList.add("active"):playSoundOnErrorButton.classList.remove("active"),wordLimitModeInput.value=wordMax,timeLimitModeInput.value=timeMax}function init(){createTestSets(),reset(),updateCheatsheetStyling(currentLevel)}function openMenu(){let e=document.querySelector("content"),t=document.querySelector("menubar"),o=document.querySelector(".config .settings");t.classList.remove("dispose"),o.classList.add("active"),setTimeout(function(){e.classList.remove("hidemenu")},10)}function closeMenu(){let e=document.querySelector("content"),t=document.querySelector("menubar"),o=document.querySelector(".config .settings");e.classList.add("hidemenu"),setTimeout(function(){t.classList.add("dispose"),o.classList.remove("active")},100)}function toggleMenu(){let e=document.querySelector("content");e.classList.contains("hidemenu")?openMenu():closeMenu()}function toggleFullSentenceModeUI(){fullSentenceModeLevelButton.classList.toggle("visible")}function toggleTimeLimitModeUI(){seconds=timeLimitModeInput.value%60,minutes=Math.floor(timeLimitModeInput.value/60),scoreText.style.display="none",scoreMax=10*timeMax,timeLimitModeInput.classList.toggle("dispose"),wordLimitModeInput.classList.toggle("dispose")}function toggleWordScrollingModeUI(){prompt.classList.toggle("paragraph"),document.querySelector("#fadeElement").classList.toggle("fade")}function playClickSound(){if(!playSoundOnClick)return;const e=Math.floor(6*Math.random()),t=clickSounds[e];t.counter++,2===t.counter&&(t.counter=0),t.sounds[t.counter].currentTime=0,t.sounds[t.counter].play()}function playErrorSound(){playSoundOnError&&(errorSound.currentTime=0,errorSound.play())}function updateLayoutUI(){let e;switch(currentKeyboard){case"ansi":e=document.querySelector(".cheatsheet"),e.parentNode.classList.add("ansi"),e.parentNode.classList.remove("iso","ortho"),e.innerHTML=ansiDivs,customInput.classList.add("ansi"),customInput.classList.remove("iso","ortho"),inputKeyboard.innerHTML=customLayout.ansi,layoutMaps.colemakdh.KeyZ="x",layoutMaps.colemakdh.KeyX="c",layoutMaps.colemakdh.KeyC="d",layoutMaps.colemakdh.KeyV="v",layoutMaps.colemakdh.KeyB="z",layoutMaps.colemakdhs.KeyZ="x",layoutMaps.colemakdhs.KeyX="c",layoutMaps.colemakdhs.KeyC="d",layoutMaps.colemakdhs.KeyV="v",layoutMaps.colemakdhs.KeyB="z",layoutMaps.tarmakdh.KeyZ="x",layoutMaps.tarmakdh.KeyX="c",layoutMaps.tarmakdh.KeyC="d",layoutMaps.tarmakdh.KeyV="v",layoutMaps.tarmakdh.KeyB="z",levelDictionaries.tarmakdh.lvl1="qwagv",levelDictionaries.tarmakdh.lvl3="ftbzxc",layoutMaps.canary.KeyZ="j",layoutMaps.canary.KeyX="v",layoutMaps.canary.KeyC="d",layoutMaps.canary.KeyV="g",layoutMaps.canary.KeyB="q",layoutMaps.canary.KeyN="m",layoutMaps.canary.KeyG="b",layoutMaps.canary.KeyH="f",layoutMaps.canary.KeyT="k",layoutMaps.canary.KeyU="x";break;case"iso":e=document.querySelector(".cheatsheet"),e.parentNode.classList.add("iso"),e.parentNode.classList.remove("ansi","ortho"),e.innerHTML=isoDivs,customInput.classList.add("iso"),customInput.classList.remove("ansi","ortho"),inputKeyboard.innerHTML=customLayout.iso,layoutMaps.colemakdh.IntlBackslash="z",layoutMaps.colemakdh.KeyZ="x",layoutMaps.colemakdh.KeyX="c",layoutMaps.colemakdh.KeyC="d",layoutMaps.colemakdh.KeyV="v",delete layoutMaps.colemakdh.KeyB,layoutMaps.colemakdhs.IntlBackslash="z",layoutMaps.colemakdhs.KeyZ="x",layoutMaps.colemakdhs.KeyX="c",layoutMaps.colemakdhs.KeyC="d",layoutMaps.colemakdhs.KeyV="v",delete layoutMaps.colemakdhs.KeyB,layoutMaps.tarmakdh.IntlBackslash="z",layoutMaps.tarmakdh.KeyZ="x",layoutMaps.tarmakdh.KeyX="c",layoutMaps.tarmakdh.KeyC="d",layoutMaps.tarmakdh.KeyV="v",delete layoutMaps.tarmakdh.KeyB,levelDictionaries.tarmakdh.lvl1="qwagv",levelDictionaries.tarmakdh.lvl3="ftbzxc",layoutMaps.canary.IntlBackslash="q",layoutMaps.canary.KeyZ="j",layoutMaps.canary.KeyX="v",layoutMaps.canary.KeyC="d",layoutMaps.canary.KeyV="g",delete layoutMaps.canary.KeyB,layoutMaps.canary.KeyN="m",layoutMaps.canary.KeyG="b",layoutMaps.canary.KeyH="f",layoutMaps.canary.KeyT="k",layoutMaps.canary.KeyU="x";break;case"ortho":e=document.querySelector(".cheatsheet"),e.parentNode.classList.add("ortho"),e.parentNode.classList.remove("ansi","iso"),e.innerHTML=orthoDivs,customInput.classList.add("ortho"),customInput.classList.remove("ansi","iso"),inputKeyboard.innerHTML=customLayout.ortho,layoutMaps.colemakdh.KeyZ="z",layoutMaps.colemakdh.KeyX="x",layoutMaps.colemakdh.KeyC="c",layoutMaps.colemakdh.KeyV="d",layoutMaps.colemakdh.KeyB="v",layoutMaps.colemakdhs.KeyZ="z",layoutMaps.colemakdhs.KeyX="x",layoutMaps.colemakdhs.KeyC="c",layoutMaps.colemakdhs.KeyV="d",layoutMaps.colemakdhs.KeyB="v",layoutMaps.tarmakdh.KeyZ="z",layoutMaps.tarmakdh.KeyX="x",layoutMaps.tarmakdh.KeyC="c",layoutMaps.tarmakdh.KeyV="d",layoutMaps.tarmakdh.KeyB="v",levelDictionaries.tarmakdh.lvl1="qwagzxc",levelDictionaries.tarmakdh.lvl3="ftbv",layoutMaps.canary.KeyZ="q",layoutMaps.canary.KeyX="j",layoutMaps.canary.KeyC="v",layoutMaps.canary.KeyV="d",layoutMaps.canary.KeyB="k",layoutMaps.canary.KeyN="x",layoutMaps.canary.KeyG="g",layoutMaps.canary.KeyH="m",layoutMaps.canary.KeyT="b",layoutMaps.canary.KeyU="f"}"custom"==currentLayout?(openUIButton.classList.remove("dispose"),startCustomKeyboardEditing()):(customInput.classList.remove("show"),openUIButton.classList.add("dispose"));for(let e=1;e<=6;e++)currentLayout.match(/tarmak/)?document.querySelector(".lvl"+e).innerHTML=`<span>${e-1}</span><label>Step</label>`:document.querySelector(".lvl"+e).innerHTML=`<span>${e}</span><label>Level</label>`;keyboardMap=layoutMaps[currentLayout],console.log(currentLayout),console.log(currentKeyboard),letterDictionary=levelDictionaries[currentLayout],"custom"==currentLayout&&customUIKeyInput.focus()}function changeLayout(e){currentLayout=e,layout.setAttribute("data-value",e),localStorage.setItem("currentLayout",currentLayout),updateLayoutUI(),init(),updateSelectors()}function changeKeyboard(e){currentKeyboard=e,keyboard.setAttribute("data-value",e),localStorage.setItem("currentKeyboard",currentKeyboard),updateLayoutUI(),init(),updateSelectors()}function startCustomKeyboardEditing(e){if(localStorage.customLevelDictionary&&localStorage.customLayoutMap?(initialCustomKeyboardState=Object.assign({},getJSON("customLayoutMap")),initialCustomLevelsState=Object.assign({},getJSON("customLevelDictionary"))):(initialCustomKeyboardState=Object.assign({},layoutMaps.custom),initialCustomLevelsState=Object.assign({},levelDictionaries.custom)),loadCustomLayout(initialCustomKeyboardState),loadCustomLevels(initialCustomLevelsState),!0!==e&&localStorage.customLevelDictionary&&localStorage.customLayoutMap)return;subSection.classList.remove("dispose"),setTimeout(function(){customInput.classList.add("show"),document.querySelector(".currentCustomLevel").click()},10);let t=document.querySelector(".defaultSelectedKey");selectInputKey(t)}function selectInputKey(e){clearSelectedInput(),e.classList.add("selectedInputKey"),""==e.children[0].innerHTML&&(e.children[0].innerHTML="_"),customUIKeyInput.focus()}function removeKeyFromLevels(e){let t=Object.keys(levelDictionaries.custom);for(lvl of t){let t=e.id.toString().replace("custom","");levelDictionaries.custom[lvl]=levelDictionaries.custom[lvl].replace(e.children[0].innerHTML,""),layoutMaps.custom[t]=" "}}function loadCustomLayout(e){console.log("new layout"),layoutMaps.custom=Object.assign({},e),keyboardMap=layoutMaps.custom;let t=document.querySelectorAll("row.custom > key");t.forEach(e=>{let t=e.id.substring(6);keyboardMap[t]&&(" "==keyboardMap[t]&&e.classList.remove("active"),e.innerHTML=`<span>${keyboardMap[t]}</span>`)})}function loadCustomLevels(e){levelDictionaries.custom=Object.assign({},e),letterDictionary=levelDictionaries.custom}function switchSelectedInputKey(e){function t(){return document.querySelector(".selectedInputKey")}let o;if("right"==e)o=t().nextElementSibling,o.classList.contains("skip")&&(o=o.nextElementSibling);else if("left"==e)o=t().previousElementSibling,o.classList.contains("skip")&&(o=o.previousElementSibling);else if("up"==e){let e,n=t();for(let t=0;t<n.parentElement.children.length;t++)if(n.parentElement.children[t]==n){console.log("found! "+t),e=t;break}o=t().parentElement.previousElementSibling.children[e].classList.contains("grey")?t().parentElement.previousElementSibling.children[e]:t()}else if("down"==e){let e,n=t();for(let t=0;t<n.parentElement.children.length;t++)if(n.parentElement.children[t]==n){console.log("found! "+t),e=t;break}o=t().parentElement.nextElementSibling.children[e].classList.contains("grey")?t().parentElement.nextElementSibling.children[e]:t()}o.classList.contains("finalKey")||o.classList.contains("firstKey")?o=t():o.classList.contains("rowEnd")?o=t().parentElement.nextElementSibling.children[1]:o.classList.contains("rowStart")&&(o=t().parentElement.previousElementSibling.children[t().parentElement.previousElementSibling.children.length-2]),clearSelectedInput(),o.classList.add("selectedInputKey"),""==o.children[0].innerHTML&&(o.children[0].innerHTML="_")}function clearSelectedInput(){let e=document.querySelectorAll(".selectedInputKey");for(let t=0;t<e.length;t++)e[t].classList.remove("selectedInputKey"),console.log(e[t].children[0].innerHTML),"_"==e[t].children[0].innerHTML&&(e[t].children[0].innerHTML="")}function checkAnswerToIndex(){let e=fakeInput.innerText;return e.slice(0,letterIndex)==correctAnswer.slice(0,letterIndex)}function switchLevel(e){localStorage.setItem("currentLevel",e),console.log(e),gameON=!1,document.querySelector("#userInput").value="",clearCurrentLevelStyle(),document.querySelector(".lvl"+e).classList.add("currentLevel"),fullSentenceMode=8==e,8==e&&(e=7),currentLevel=e,reset(),updateCheatsheetStyling(e)}function updateCheatsheetStyling(e){let t=document.querySelectorAll("row:not(.custom) > key");for(n of t){n.classList.add("inactive"),n.classList.remove("active"),n.classList.remove("homeRow"),n.classList.remove("currentLevelKeys"),n.classList.remove("punctuation"),n.innerHTML="<span></span>";let t=Object.keys(letterDictionary);for(let o=0;o<e;o++){let r=keyboardMap[n.id],a=letterDictionary[t[o]]+punctuation;a.includes(r)&&(n.innerHTML=`<span>${r}</span>`,n.classList.remove("inactive"),punctuation.includes(r)?(n.classList.remove("active"),n.classList.add("punctuation")):0==o?n.classList.add("homeRow"):6==o||(o==e-1?(n.classList.remove("active"),n.classList.add("currentLevelKeys")):n.classList.add("active")))}}}function reset(){navInit(),deleteFirstLine=!1,deleteLatestWord=!1,prompt.innerHTML="",answerString="",input.value="",fakeInput.innerText="",answerWordArray=[],idCount=0,sentenceStartIndex=-1,gameON=!1,console.log("reset called"),letterIndex=0,wordIndex=0,lineIndex=0,promptOffset=0,prompt.style.left=0,correct=0,errors=0,score=-1,requiredLetters=(levelDictionaries[currentLayout]["lvl"+currentLevel]+punctuation).split(""),timeLimitMode?(seconds=timeLimitModeInput.value%60,minutes=Math.floor(timeLimitModeInput.value/60)):(minutes=0,seconds=0),resetTimeText(),testResults.classList.add("transparent"),resetButton.classList.add("dispose"),prompt.classList.remove("dispose");for(let e=1;e<=3;e++)addLineToPrompt(),1==e&&(correctAnswer=answerWordArray[0]);answerLetterArray=answerString.split(""),updateScoreText(),input.focus()}function addLineToPrompt(){let e=generateLine(scoreMax-score-answerWordArray.length-1);answerString+=e,prompt.innerHTML+=convertLineToHTML(e),answerWordArray=answerWordArray.concat(e.split(" "))}function convertLineToHTML(e){let t="";for(t=`<span class='line'><span class='word' id='id${idCount}'>`,i=0;i<=e.length;i++)i==e.length?(t+="</span> </span>",idCount++):" "==e[i]?(idCount++,t+=" </span>",t+=`<span class='word' id='id${idCount}'>`):t+="<span>"+e[i]+"</span>";return t}function checkAnswer(){let e=fakeInput.innerText;return e==correctAnswer}function endGame(){let e;prompt.classList.toggle("dispose"),resetButton.classList.remove("dispose"),gameON=!1,e=timeLimitMode?((correct+errors)/5/(timeLimitModeInput.value/60)).toFixed(2):((correct+errors)/5/(minutes+seconds/60)).toFixed(2),accuracyText.innerHTML="Accuracy: "+(100*correct/(correct+errors)).toFixed(2)+"%",wpmText.innerHTML="WPM: "+e,testResults.classList.toggle("transparent"),correct=0,errors=0,resetButton.focus(),updateScoreText(),input.value="",fakeInput.innerText="",letterIndex=0}function generateLine(e){let t="";if(fullSentenceMode){let e=0;return-1==sentenceStartIndex?(sentenceStartIndex=getPosition(sentence,".",e)+1,sentenceEndIndex=sentence.substring(sentenceStartIndex+lineLength+2).indexOf(" ")+sentenceStartIndex+lineLength+1,t=sentence.substring(sentenceStartIndex,sentenceEndIndex+1)):(sentenceStartIndex=sentenceEndIndex+1,sentenceEndIndex=sentence.substring(sentenceStartIndex+lineLength+2).indexOf(" ")+sentenceStartIndex+lineLength+1,t=sentence.substring(sentenceStartIndex,sentenceEndIndex+1),console.log(sentenceStartIndex),console.log(sentenceEndIndex)),t=t.substring(1),t}if(wordLists["lvl"+currentLevel].length>0){let o=levelDictionaries[currentLayout]["lvl"+currentLevel]+punctuation,n=0,r=0;for(let a=0;a<lineLength&&!(r>=e);a=a){let e=Math.floor(Math.random()*wordLists["lvl"+currentLevel].length),s=wordLists["lvl"+currentLevel][e];n>12e3&&(n>3e4?(t+=levelDictionaries[currentLayout]["lvl"+currentLevel]+" ",a+=s.length,r++,n=0,requiredLetters=o.split(""),console.log("taking too long to find proper word")):requiredLetters=o.split("")),contains(s,requiredLetters)&&(onlyLower&&containsUpperCase(s)||(t+=s+" ",a+=s.length,r++,removeIncludedLetters(requiredLetters,s),0==requiredLetters.length&&(requiredLetters=o.split("")))),n++,n>7e3&&(s=randomLetterJumble(),t+=s+" ",a+=s.length,r++,requiredLetters=o.split(""))}}else{levelDictionaries[currentLayout]["lvl"+currentLevel];let o=0;if(0==levelDictionaries[currentLayout]["lvl"+currentLevel].length)t="";else for(let n=0;n<lineLength&&(wordToAdd=randomLetterJumble(),t+=wordToAdd+" ",n+=wordToAdd.length,console.log("i: "+n),o++,!(o>=e));n=n);}return t=t.substring(0,t.length-1),t}function randomLetterJumble(){let e=Math.floor(5*Math.random())+1,t="";for(let o=0;o<e;o++){let e=Math.floor(Math.random()*levelDictionaries[currentLayout]["lvl"+currentLevel].length);t+=levelDictionaries[currentLayout]["lvl"+currentLevel][e]}return t}function removeIncludedLetters(e,t){t.split("").forEach(t=>{e.includes(t)&&e.splice(e.indexOf(t),1)})}function containsUpperCase(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=!1;return e.split("").forEach(e=>{t.includes(e)&&(o=!0)}),o}function handleCorrectWord(){fakeInput.classList.remove("red"),answerWordArray.shift(),(prompt.children[0].children.length-1==0||wordIndex>=prompt.children[0].children.length-1)&&(console.log("new line "+prompt),lineIndex++,addLineToPrompt(),wordScrollingMode||(prompt.removeChild(prompt.children[0]),wordIndex=-1)),wordScrollingMode?(deleteLatestWord=!0,prompt.classList.add("smoothScroll"),promptOffset+=prompt.children[0].children[0].offsetWidth,prompt.style.left="-"+promptOffset+"px",prompt.children[0].firstChild.style.opacity=0):wordIndex++,correctAnswer=answerWordArray[0]}function updateScoreText(){scoreText.innerHTML=++score+"/"+scoreMax}function resetTimeText(){let e=minutes,t=seconds;1===minutes.toString().length&&(e="0"+minutes),1===seconds.toString().length&&(t="0"+seconds),timeText.innerText=e+":"+t}function clearCurrentLevelStyle(){for(button of buttons)button.classList.remove("currentLevel")}function createTestSets(){let e=Object.keys(wordLists),t=punctuation;for(let o=0;o<e.length;o++){let n;"custom"!=currentLayout||6!=o?(n=levelDictionaries[currentLayout]["lvl"+(o+1)]+punctuation,t+=letterDictionary[e[o]]):n=t,wordLists[e[o]]=[],wordLists[e[o]]=generateList(t,n)}}let score,correctAnswer,sentenceEndIndex,prompt=document.querySelector(".prompt"),wordChain=document.querySelector("#wordChain"),answer=document.querySelector("#answer"),scoreText=document.querySelector("#scoreText"),timeText=document.querySelector("#timeText"),resetButton=document.querySelector("#resetButton"),accuracyText=document.querySelector("#accuracyText"),wpmText=document.querySelector("#wpmText"),testResults=document.querySelector("#testResults"),input=document.querySelector("#userInput"),fakeInput=document.querySelector("#fakeInput"),inputKeyboard=document.querySelector("#inputKeyboard"),customInput=document.querySelector(".customInput"),buttons=document.querySelectorAll("ul.nav li"),currentWord=document.querySelector("#currentWord"),layout=document.querySelector("#layout"),keyboard=document.querySelector("#keyboard"),mappingStatusButton=document.querySelector("#keymapping"),mappingStatusText=document.querySelector("#maptip"),saveButton=document.querySelector(".saveButton"),discardButton=document.querySelector(".discardButton"),openUIButton=document.querySelector(".openUIButton"),customUIKeyInput=document.querySelector("#customUIKeyInput"),subSection=document.querySelector("#sub"),promptOffset=0,scoreMax=localStorage.getItem("scoreMax")||50,timeMax=localStorage.getItem("timeMax")||60,wordMax=localStorage.getItem("wordMax")||50,seconds=0,minutes=0,gameON=!1,correct=0,errors=0,currentLevel=localStorage.getItem("currentLevel")||1,letterIndex=0,onlyLower=!localStorage.getItem("onlyLower")||"true"===localStorage.getItem("onlyLower"),answerString="",keyboardMap=layoutMaps.colemak,letterDictionary=levelDictionaries.colemak,currentLayout=localStorage.getItem("currentLayout")||"colemak",currentKeyboard=localStorage.getItem("currentKeyboard")||"ansi",shiftDown=!1,fullSentenceMode=!1,fullSentenceModeEnabled="true"===localStorage.getItem("fullSentenceModeEnabled"),requireBackspaceCorrection=!localStorage.getItem("requireBackspaceCorrection")||"true"===localStorage.getItem("requireBackspaceCorrection"),timeLimitMode="true"===localStorage.getItem("timeLimitMode"),wordScrollingMode=!localStorage.getItem("wordScrollingMode")||"true"===localStorage.getItem("wordScrollingMode"),showCheatsheet=!localStorage.getItem("showCheatsheet")||"true"===localStorage.getItem("showCheatsheet"),playSoundOnClick="true"===localStorage.getItem("playSoundOnClick"),playSoundOnError="true"===localStorage.getItem("playSoundOnError"),deleteFirstLine=!1,deleteLatestWord=!1,sentenceStartIndex=-1,lineLength=19,lineIndex=0,wordIndex=0,idCount=0,answerWordArray=[],specialKeys=["Pause","ScrollLock","Insert","PageUp","PageDown","Delete","End","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape","Tab","CapsLock","Control","Alt","ContextMenu","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","NumLock","Backspace","Shift"," ","Enter","OS"],punctuation=localStorage.getItem("punctuation")||"",requiredLetters="",initialCustomKeyboardState="",initialCustomLevelsState="",preferenceButton=document.querySelector(".settings"),capitalLettersAllowed=document.querySelector(".capitalLettersAllowed"),fullSentenceModeToggle=document.querySelector(".fullSentenceMode"),fullSentenceModeLevelButton=document.querySelector(".lvl8"),requireBackspaceCorrectionToggle=document.querySelector(".requireBackspaceCorrectionToggle"),wordLimitModeButton=document.querySelector(".wordLimitModeButton"),wordLimitModeInput=document.querySelector(".wordLimitModeInput"),timeLimitModeButton=document.querySelector(".timeLimitModeButton"),timeLimitModeInput=document.querySelector(".timeLimitModeInput"),wordScrollingModeButton=document.querySelector(".wordScrollingModeButton"),punctuationModeButton=document.querySelector(".punctuationModeButton"),showCheatsheetButton=document.querySelector(".showCheatsheetButton"),playSoundOnClickButton=document.querySelector(".playSoundOnClick"),playSoundOnErrorButton=document.querySelector(".playSoundOnError");start(),init(),setInterval(()=>{gameON&&(timeLimitMode?(seconds--,seconds<=0&&minutes<=0&&endGame(),seconds<0&&(seconds=59,minutes--)):(seconds++,seconds>=60&&(seconds=0,minutes++)),resetTimeText())},1e3),input.addEventListener("keydown",e=>{gameON=!0}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(closeMenu(),customInput.classList.contains("show")&&(discardButton.click(),clearSelectedInput(),init()))}),preferenceButton.addEventListener("click",()=>{toggleMenu()}),capitalLettersAllowed.addEventListener("click",()=>{onlyLower=!onlyLower,localStorage.setItem("onlyLower",onlyLower),reset()}),requireBackspaceCorrectionToggle.addEventListener("click",()=>{requireBackspaceCorrection=!requireBackspaceCorrection,localStorage.setItem("requireBackspaceCorrection",requireBackspaceCorrection),reset()}),fullSentenceModeToggle.addEventListener("click",()=>{fullSentenceModeEnabled=!fullSentenceModeEnabled,localStorage.setItem("fullSentenceModeEnabled",fullSentenceModeEnabled),toggleFullSentenceModeUI(),switchLevel(fullSentenceModeEnabled?8:1),reset()}),timeLimitModeButton.addEventListener("click",()=>{1==timeLimitMode||(timeLimitMode=!0,toggleTimeLimitModeUI(),localStorage.setItem("timeLimitMode",timeLimitMode),reset())}),timeLimitModeInput.addEventListener("change",()=>{let e=Math.floor(timeLimitModeInput.value);scoreMax=10*e,(e<1||e>1e4)&&(e=60),timeLimitModeInput.value=e,timeMax=e,localStorage.setItem("timeMax",timeMax),seconds=e%60,minutes=Math.floor(e/60),gameON=!1,resetTimeText()}),wordLimitModeButton.addEventListener("click",()=>{0==timeLimitMode||(timeLimitMode=!1,seconds=0,minutes=0,scoreText.style.display="flex",scoreMax=wordMax,timeLimitModeInput.classList.toggle("dispose"),wordLimitModeInput.classList.toggle("dispose"),localStorage.setItem("timeLimitMode",timeLimitMode),reset())}),wordLimitModeInput.addEventListener("change",()=>{wordLimitModeInput.value>10&&wordLimitModeInput.value<=500?(wordLimitModeInput.value=10*Math.ceil(wordLimitModeInput.value/10),scoreMax=wordLimitModeInput.value,wordMax=wordLimitModeInput.value):wordLimitModeInput.value>500?(scoreMax=500,wordMax=500,wordLimitModeInput.value=500):(scoreMax=10,wordMax=10,wordLimitModeInput.value=10),localStorage.setItem("scoreMax",scoreMax),localStorage.setItem("wordMax",scoreMax),reset()}),wordScrollingModeButton.addEventListener("click",()=>{wordScrollingMode=!wordScrollingMode,localStorage.setItem("wordScrollingMode",wordScrollingMode),toggleWordScrollingModeUI(),reset()}),punctuationModeButton.addEventListener("click",()=>{console.log("punctuation mode toggled"),punctuation=""==punctuation?"'.-":"",localStorage.setItem("punctuation",punctuation),createTestSets(),updateCheatsheetStyling(currentLevel),reset()}),showCheatsheetButton.addEventListener("click",()=>{showCheatsheet?document.querySelector(".cheatsheet").classList.add("dispose"):document.querySelector(".cheatsheet").classList.remove("dispose"),showCheatsheet=!showCheatsheet,localStorage.setItem("showCheatsheet",showCheatsheet),navInit()}),playSoundOnClickButton.addEventListener("click",()=>{playSoundOnClick=!playSoundOnClick,localStorage.setItem("playSoundOnClick",playSoundOnClick),navInit()}),playSoundOnErrorButton.addEventListener("click",()=>{playSoundOnError=!playSoundOnError,localStorage.setItem("playSoundOnError",playSoundOnError),navInit()});const errorSound=new Audio("sounds/error.wav"),clickSounds=[{sounds:[new Audio("sounds/click1.wav"),new Audio("sounds/click1.wav")],counter:0},{sounds:[new Audio("sounds/click2.wav"),new Audio("sounds/click2.wav")],counter:0},{sounds:[new Audio("sounds/click3.wav"),new Audio("sounds/click3.wav")],counter:0},{sounds:[new Audio("sounds/click4.wav"),new Audio("sounds/click4.wav")],counter:0},{sounds:[new Audio("sounds/click5.wav"),new Audio("sounds/click5.wav")],counter:0},{sounds:[new Audio("sounds/click6.wav"),new Audio("sounds/click6.wav")],counter:0}];openUIButton.addEventListener("click",()=>{startCustomKeyboardEditing(!0)}),saveButton.addEventListener("click",()=>{storeCustomLayout(),customInput.classList.remove("show"),setTimeout(function(){subSection.classList.add("dispose")},200),clearSelectedInput(),init()}),discardButton.addEventListener("click",()=>{customInput.classList.remove("show"),setTimeout(function(){subSection.classList.add("dispose")},200),clearSelectedInput(),loadCustomLayout(initialCustomKeyboardState),loadCustomLevels(initialCustomLevelsState),console.log(levelDictionaries.custom),init()}),document.addEventListener("click",function(e){if(k=e.target.closest("row.custom > key.grey"),k?(customUIKeyInput.focus(),clearSelectedInput(),k.classList.add("selectedInputKey"),""!=k.children[0].innerHTML&&" "!=k.children[0].innerHTML||(k.children[0].innerHTML="_")):clearSelectedInput(),k=e.target.closest("ul.customLevels li"),k){let e=document.querySelector(".currentCustomLevel");e&&e.classList.remove("currentCustomLevel"),customUIKeyInput.focus(),k.classList.add("currentCustomLevel"),e=document.querySelector(".currentCustomLevel");let t=document.querySelectorAll("row.custom > key");for(n of t)0!=n.children[0].innerHTML&&levelDictionaries.custom[e.getAttribute("data-level")].includes(n.children[0].innerHTML)?n.classList.add("active"):n.classList.remove("active")}},!1),customUIKeyInput.addEventListener("keydown",e=>{let t=document.querySelector(".selectedInputKey");if("_"!=t.children[0].innerHTML&&removeKeyFromLevels(t),"Shift"!==e.key&&"Control"!==e.key&&"Escape"!==e.key&&"Delete"!==e.key&&" "!==e.key&&"Backspace"!==e.key&&"CapsLock"!==e.key&&"Enter"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key&&"ArrowDown"!==e.key){let o=document.querySelector(".currentCustomLevel").getAttribute("data-level");if(t.children[0].innerHTML=e.key,t.classList.add("active"),t.id){let o=t.id.toString().replace("custom","");o=o.toString().replace("shift",""),shiftDown||(layoutMaps.custom[o]=e.key),layoutMaps.custom.shiftLayer[o]=e.key.toUpperCase()}levelDictionaries.custom[o]+=e.key,levelDictionaries.custom.lvl7+=e.key,switchSelectedInputKey("right")}else"Backspace"===e.key||"Delete"===e.key?(t.children[0].innerHTML="_",t.classList.remove("active"),layoutMaps.custom.shiftLayer[t.id]=" ",t.id&&(layoutMaps.custom[t.id]=" ",removeKeyFromLevels(t))):"ArrowLeft"===e.key?switchSelectedInputKey("left"):"ArrowRight"===e.key?(console.log("right"),switchSelectedInputKey("right")):"ArrowUp"===e.key?switchSelectedInputKey("up"):"ArrowDown"===e.key&&switchSelectedInputKey("down");customUIKeyInput.value=""});for(let e=0;e<buttons.length;e++)buttons[e].addEventListener("click",function(){let t=e+1;switchLevel(t)});resetButton.addEventListener("click",()=>{console.log("reset button called"),reset()}),document.addEventListener("keyup",e=>{e.preventDefault()});